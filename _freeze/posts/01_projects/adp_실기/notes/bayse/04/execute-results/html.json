{
  "hash": "1e0a66939853e7ae5e77ba5406e06933",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"수량 추정\"\ndate: 2025-06-19\ncategories: [\"확률 통계\"]\n---\n\n\n\n\n![](/img/stat-thumb.jpg){.post-thumbnail}\n\n## 기관차 문제\n\n- 각 철도를 지나가는 기관차에 1부터 N까지의 순서로 번호를 붙인다.\n- 60번 번호가 붙은 기관차를 보았다.\n- 이 철도에 몇 개의 기관차가 지나가는지 추정해보자\n\n::: {#7cd48f51 .cell execution_count=1}\n``` {.python .cell-code}\nimport numpy as np\nfrom empiricaldist import Pmf\n\nhypos = np.arange(1, 1001)\nprior = Pmf(1, hypos)\n```\n:::\n\n\n- 가정: N은 1부터 1000까지의 값 중 한 값이 동일한 확률로 선택될 수 있다.\n\n::: {#a3077e04 .cell execution_count=2}\n``` {.python .cell-code}\ndef update_train(pmf, data):\n  hypos = pmf.qs\n  likelihood = 1 / hypos\n  likelihood[(data > hypos)] = 0\n  pmf *= likelihood\n  pmf.normalize()\n```\n:::\n\n\n::: {#9002e66b .cell execution_count=3}\n``` {.python .cell-code}\ndata = 60\nposterior = prior.copy()\nupdate_train(posterior, data)\n```\n:::\n\n\n::: {#a5e2f2e4 .cell execution_count=4}\n``` {.python .cell-code}\nimport matplotlib.pyplot as plt\n\nplt.rcParams['font.family'] = 'Noto Sans KR'\n\nposterior.plot(label='60번 기관차 발견 시 전체 기관차 수의 사후확률', color='C5')\nplt.legend()\nplt.title('사후 확률')\nplt.xlabel('기관차 수')\nplt.ylabel('PMF')\n```\n\n::: {.cell-output .cell-output-display execution_count=20}\n```\nText(0, 0.5, 'PMF')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](04_files/figure-html/cell-5-output-2.png){width=601 height=451}\n:::\n:::\n\n\n::: {#e727b870 .cell execution_count=5}\n``` {.python .cell-code}\nposterior.max_prob()\n```\n\n::: {.cell-output .cell-output-display execution_count=21}\n```\n60\n```\n:::\n:::\n\n\n- 당연하다는 듯이 60이 최선의 선택. 하지만 이는 별로 도움이 안됨.\n- 대안으로 사후확률의 평균을 구해본다.\n\n::: {#dc8d9807 .cell execution_count=6}\n``` {.python .cell-code}\nposterior.mean()\n```\n\n::: {.cell-output .cell-output-display execution_count=22}\n```\n333.41989326370776\n```\n:::\n:::\n\n\n- 해당 값을 선택하는 것이 장기적으로 좋은 선택.\n\n::: {#4f22f0c1 .cell execution_count=7}\n``` {.python .cell-code}\nimport pandas as pd\n\ndf = pd.DataFrame(columns=['사후확률 분포 평균'])\ndf.index.name = '상한값'\n\ndataset = [30, 60, 90]\n\nfor high in [500, 1000, 2000]:\n    hypos = np.arange(1, high+1)\n    pmf = Pmf(1, hypos)\n    for data in dataset:\n        update_train(pmf, data)\n    df.loc[high] = pmf.mean()\ndf\n```\n\n::: {.cell-output .cell-output-display execution_count=23}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>사후확률 분포 평균</th>\n    </tr>\n    <tr>\n      <th>상한값</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>500</th>\n      <td>151.849588</td>\n    </tr>\n    <tr>\n      <th>1000</th>\n      <td>164.305586</td>\n    </tr>\n    <tr>\n      <th>2000</th>\n      <td>171.338181</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n- 하지만 상한값의 범위의 변화에 따른 사후확률 분포의 평균값이 크게 달라진다.\n- 이럴때는 2가지 방법이 있다.\n  1. 데이터를 더 확보\n  1. 배경지식을 더 확보해서 더 나은 사전확률을 선택\n\n## 멱법칙 사전확률\n\n- 기관차 수는 멱법칙을 주로 따르는 것으로 알려져 있음\n- 더 적합한 사전확률은 안정적인 사전확률을 제공할 수 있다.\n\n::: {#dfdba5bd .cell execution_count=8}\n``` {.python .cell-code}\nalpha = 1.0\nps = hypos ** (-alpha)\npower = Pmf(ps, hypos, name='power law')\npower.normalize()\n```\n\n::: {.cell-output .cell-output-display execution_count=24}\n```\n8.178368103610282\n```\n:::\n:::\n\n\n::: {#64d6a0f9 .cell execution_count=9}\n``` {.python .cell-code}\nuniform = Pmf(1, hypos, name='uniform')\nuniform.normalize()\n\npower.plot(label='power', color='skyblue')\nuniform.plot(label='uniform', color='pink')\nplt.legend()\nplt.title('사전확률 분포')\nplt.xlabel('기관차 수')\nplt.ylabel('PMF')\n```\n\n::: {.cell-output .cell-output-display execution_count=25}\n```\nText(0, 0.5, 'PMF')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](04_files/figure-html/cell-10-output-2.png){width=594 height=451}\n:::\n:::\n\n\n::: {#05b363c4 .cell execution_count=10}\n``` {.python .cell-code}\nupdate_train(uniform, 60)\nupdate_train(power, 60)\n\npower.plot(label='power', color='skyblue')\nuniform.plot(label='uniform', color='pink')\nplt.legend()\nplt.title('사후확률 분포')\nplt.xlabel('기관차 수')\nplt.ylabel('PMF')\n```\n\n::: {.cell-output .cell-output-display execution_count=26}\n```\nText(0, 0.5, 'PMF')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](04_files/figure-html/cell-11-output-2.png){width=609 height=451}\n:::\n:::\n\n\n::: {#223cfb71 .cell execution_count=11}\n``` {.python .cell-code}\ndf = pd.DataFrame(columns=['사후확률 분포 평균'])\ndf.index.name = '상한값'\n\nalpha = 1.0\ndataset = [30, 60, 90]\n\nfor high in [500, 1000, 2000]:\n    hypos = np.arange(1, high+1)\n    ps = hypos**(-alpha)\n    power = Pmf(ps, hypos)\n    for data in dataset:\n        update_train(power, data)\n    df.loc[high] = power.mean()\ndf\n```\n\n::: {.cell-output .cell-output-display execution_count=27}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>사후확률 분포 평균</th>\n    </tr>\n    <tr>\n      <th>상한값</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>500</th>\n      <td>130.708470</td>\n    </tr>\n    <tr>\n      <th>1000</th>\n      <td>133.275231</td>\n    </tr>\n    <tr>\n      <th>2000</th>\n      <td>133.997463</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## 신뢰구간\n\n::: {#e18bda50 .cell execution_count=12}\n``` {.python .cell-code}\npower.credible_interval(0.9)\n```\n\n::: {.cell-output .cell-output-display execution_count=28}\n```\narray([ 91., 243.])\n```\n:::\n:::\n\n\n## 연습문제\n\n### 5-1\n\n::: {#70e2ae98 .cell execution_count=13}\n``` {.python .cell-code}\nfrom scipy.stats import binom\n\ndef update(pmf, k, p):\n    likelihood = binom.pmf(k, pmf.qs, p)\n    pmf *= likelihood\n    pmf.normalize()\n\nhypos = np.arange(1, 2001)\nprior = Pmf(1, hypos)\n\nposterior = prior.copy()\n\nupdate(posterior, 2, 1/365)\nprint(f\"5월 11일 데이터 적용 후 평균 인원수: {posterior.mean():.1f}\")\n\nupdate(posterior, 1, 1/365)\nprint(f\"5월 23일 데이터 적용 후 평균 인원수: {posterior.mean():.1f}\")\n\nupdate(posterior, 0, 1/365)\nprint(f\"8월 1일 데이터 적용 후 평균 인원수: {posterior.mean():.1f}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n5월 11일 데이터 적용 후 평균 인원수: 957.1\n5월 23일 데이터 적용 후 평균 인원수: 721.7\n8월 1일 데이터 적용 후 평균 인원수: 486.2\n```\n:::\n:::\n\n\n::: {#db5066ce .cell execution_count=14}\n``` {.python .cell-code}\nestimated_people = posterior.mean()\nprint(f\"추정된 강당 인원수: {estimated_people:.1f}명\")\n\nprob_over_1200 = posterior[posterior.qs > 1200].sum()\nprint(f\"1200명을 초과할 확률: {prob_over_1200:.4f} ({prob_over_1200*100:.2f}%)\")\n\nci_90 = posterior.credible_interval(0.9)\nprint(f\"90% 신뢰구간: [{ci_90[0]:.0f}, {ci_90[1]:.0f}]\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n추정된 강당 인원수: 486.2명\n1200명을 초과할 확률: 0.0112 (1.12%)\n90% 신뢰구간: [166, 942]\n```\n:::\n:::\n\n\n### 5-2\n\n::: {#816547c4 .cell execution_count=15}\n``` {.python .cell-code}\ndef rabbit_likelihood(n):\n    return ((n - 1) / n) * (1/n) * (1/n) * 3\n\nhypos = np.arange(4, 11)\nprior = Pmf(1, hypos)\n\nlikelihood = [rabbit_likelihood(n) for n in hypos]\n\nposterior = prior.copy()\nposterior *= likelihood\nposterior.normalize()\n\nprint(f\"\\n추정 토끼 수 (평균): {posterior.mean():.2f}마리\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n추정 토끼 수 (평균): 5.92마리\n```\n:::\n:::\n\n\n### 5-3\n\nExercise: Suppose that in the criminal justice system, all prison sentences are either 1, 2, or 3 years, with an equal number of each. One day, you visit a prison and choose a prisoner at random. What is the probability that they are serving a 3-year sentence? What is the average remaining sentence of the prisoners you observe?\n\n::: {#b2e5565e .cell execution_count=16}\n``` {.python .cell-code}\n# 감옥 문제 해결\n# 핵심: 길이 편향(length bias) - 더 긴 형량을 받은 죄수가 감옥에 더 오래 머물러 있음\n\nimport numpy as np\nfrom empiricaldist import Pmf\n\n# 형량별 죄수 수 (같은 수)\nsentences = [1, 2, 3]  # 년 단위\nsentence_counts = [1, 1, 1]  # 각각 동일한 수\n\n# 각 형량의 죄수가 감옥에 있을 기간 (평균적으로)\n# 1년형: 평균 0.5년, 2년형: 평균 1년, 3년형: 평균 1.5년 동안 감옥에 있음\nexpected_time_in_prison = [0.5, 1.0, 1.5]\n\n# 어느 순간 감옥에 있을 죄수의 분포 (길이 편향 적용)\n# 각 형량의 죄수 수 × 평균 재소 기간\nweighted_counts = [count * time for count, time in zip(sentence_counts, expected_time_in_prison)]\n\nprint(\"형량별 가중 죄수 수:\")\nfor i, sentence in enumerate(sentences):\n    print(f\"{sentence}년형: {weighted_counts[i]}\")\n\ntotal_weighted = sum(weighted_counts)\nprobabilities = [count / total_weighted for count in weighted_counts]\n\nprint(f\"\\n무작위로 선택한 죄수의 형량 분포:\")\nfor i, sentence in enumerate(sentences):\n    print(f\"{sentence}년형 확률: {probabilities[i]:.3f}\")\n\nprint(f\"\\n3년형을 받을 확률: {probabilities[2]:.3f}\")\n\n# 평균 잔여 형량 계산\n# 각 형량에 대해 평균 잔여 기간을 계산\navg_remaining = []\nfor sentence in sentences:\n    # 균등분포 가정: 0부터 sentence까지 균등하게 분포\n    # 평균 잔여 기간 = sentence/2\n    avg_remaining.append(sentence / 2)\n\nprint(f\"\\n형량별 평균 잔여 기간:\")\nfor i, sentence in enumerate(sentences):\n    print(f\"{sentence}년형: {avg_remaining[i]:.1f}년\")\n\n# 전체 평균 잔여 형량 (가중평균)\noverall_avg_remaining = sum(prob * remaining for prob, remaining in zip(probabilities, avg_remaining))\nprint(f\"\\n관찰된 죄수들의 평균 잔여 형량: {overall_avg_remaining:.3f}년\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n형량별 가중 죄수 수:\n1년형: 0.5\n2년형: 1.0\n3년형: 1.5\n\n무작위로 선택한 죄수의 형량 분포:\n1년형 확률: 0.167\n2년형 확률: 0.333\n3년형 확률: 0.500\n\n3년형을 받을 확률: 0.500\n\n형량별 평균 잔여 기간:\n1년형: 0.5년\n2년형: 1.0년\n3년형: 1.5년\n\n관찰된 죄수들의 평균 잔여 형량: 1.167년\n```\n:::\n:::\n\n\n### 5-5\n\nExercise: The Doomsday argument is \"a probabilistic argument that claims to predict the number of future members of the human species given an estimate of the total number of humans born so far.\"\n\nSuppose there are only two kinds of intelligent civilizations that can happen in the universe. The \"short-lived\" kind go exinct after only 200 billion individuals are born. The \"long-lived\" kind survive until 2,000 billion individuals are born. And suppose that the two kinds of civilization are equally likely. Which kind of civilization do you think we live in?\n\nThe Doomsday argument says we can use the total number of humans born so far as data. According to the Population Reference Bureau, the total number of people who have ever lived is about 108 billion.\n\nSince you were born quite recently, let's assume that you are, in fact, human being number 108 billion. If  N  is the total number who will ever live and we consider you to be a randomly-chosen person, it is equally likely that you could have been person 1, or  N , or any number in between. So what is the probability that you would be number 108 billion?\n\nGiven this data and dubious prior, what is the probability that our civilization will be short-lived?\n\n::: {#d680b1b7 .cell execution_count=17}\n``` {.python .cell-code}\n# Doomsday Argument 문제 해결\n# 핵심: 베이즈 정리를 사용하여 현재까지 태어난 인구수로부터 문명의 유형을 추정\n\nimport numpy as np\nfrom empiricaldist import Pmf\n\n# 문제 설정\nobserved_position = 108  # 108번째 인간 (단위: 10억)\nshort_lived_total = 200  # 단명형 문명의 총 인구 (단위: 10억) \nlong_lived_total = 2000  # 장명형 문명의 총 인구 (단위: 10억)\n\n# 사전확률: 두 종류의 문명이 동일한 확률\nprior_short = 0.5\nprior_long = 0.5\n\nprint(\"=== Doomsday Argument 분석 ===\")\nprint(f\"관찰된 데이터: 현재까지 {observed_position}억 명이 태어남\")\nprint(f\"단명형 문명: 총 {short_lived_total}억 명까지 생존\")\nprint(f\"장명형 문명: 총 {long_lived_total}억 명까지 생존\")\nprint(f\"사전확률: 각각 {prior_short:.1f}\")\n\n# Likelihood 계산\n# 만약 총 N명이 태어날 문명이라면, 내가 108번째일 확률은 1/N (균등분포 가정)\n\nlikelihood_short = 1 / short_lived_total if observed_position <= short_lived_total else 0\nlikelihood_long = 1 / long_lived_total if observed_position <= long_lived_total else 0\n\nprint(f\"\\n=== Likelihood 계산 ===\")\nprint(f\"단명형 문명에서 108번째일 확률: {likelihood_short:.6f}\")\nprint(f\"장명형 문명에서 108번째일 확률: {likelihood_long:.6f}\")\n\n# 베이즈 정리 적용\n# P(단명형|데이터) = P(데이터|단명형) × P(단명형) / P(데이터)\n\nnumerator_short = likelihood_short * prior_short\nnumerator_long = likelihood_long * prior_long\ndenominator = numerator_short + numerator_long\n\nposterior_short = numerator_short / denominator\nposterior_long = numerator_long / denominator\n\nprint(f\"\\n=== 베이즈 업데이트 결과 ===\")\nprint(f\"단명형 문명일 사후확률: {posterior_short:.6f} ({posterior_short*100:.2f}%)\")\nprint(f\"장명형 문명일 사후확률: {posterior_long:.6f} ({posterior_long*100:.2f}%)\")\n\n# 추가 분석: 베이즈 팩터\nbayes_factor = (likelihood_short / likelihood_long) if likelihood_long > 0 else float('inf')\nprint(f\"\\n=== 추가 분석 ===\")\nprint(f\"베이즈 팩터 (단명형/장명형): {bayes_factor:.1f}\")\nprint(f\"이는 관찰된 데이터가 단명형을 {bayes_factor:.1f}배 더 지지함을 의미\")\n\n# 결론\nprint(f\"\\n=== 결론 ===\")\nif posterior_short > posterior_long:\n    print(f\"Doomsday argument에 따르면, 우리 문명은 단명형일 확률이 {posterior_short*100:.1f}%로 더 높습니다.\")\n    print(\"이는 직관과 반대되는 결과로, 108억이라는 관찰값이 200억보다 2000억에 더 가깝지만,\")\n    print(\"확률적으로는 단명형에서 이 값이 나올 가능성이 더 높다고 계산됩니다.\")\nelse:\n    print(f\"우리 문명은 장명형일 확률이 {posterior_long*100:.1f}%로 더 높습니다.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n=== Doomsday Argument 분석 ===\n관찰된 데이터: 현재까지 108억 명이 태어남\n단명형 문명: 총 200억 명까지 생존\n장명형 문명: 총 2000억 명까지 생존\n사전확률: 각각 0.5\n\n=== Likelihood 계산 ===\n단명형 문명에서 108번째일 확률: 0.005000\n장명형 문명에서 108번째일 확률: 0.000500\n\n=== 베이즈 업데이트 결과 ===\n단명형 문명일 사후확률: 0.909091 (90.91%)\n장명형 문명일 사후확률: 0.090909 (9.09%)\n\n=== 추가 분석 ===\n베이즈 팩터 (단명형/장명형): 10.0\n이는 관찰된 데이터가 단명형을 10.0배 더 지지함을 의미\n\n=== 결론 ===\nDoomsday argument에 따르면, 우리 문명은 단명형일 확률이 90.9%로 더 높습니다.\n이는 직관과 반대되는 결과로, 108억이라는 관찰값이 200억보다 2000억에 더 가깝지만,\n확률적으로는 단명형에서 이 값이 나올 가능성이 더 높다고 계산됩니다.\n```\n:::\n:::\n\n\n",
    "supporting": [
      "04_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}