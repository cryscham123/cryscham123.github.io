{
  "hash": "3c731e5cfee4baa5280e80d3ad4e7a05",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"계절성 고려\"\ndate: 2025-07-12\ncategories: [\"확률 통계\", \"시계열 분석\"]\n---\n\n\n\n\n![](/img/stat-thumb.jpg){.post-thumbnail}\n\n## SARIMA 모델\n\n- $SARIMA(p, d, q)(P, D, Q)_m$ 형태로 표현\n- $m$: 계절성 주기\n- $P, D, Q$: 계절성 AR, 차분, MA 차수\n\n::: {#bc42b824 .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nplt.rcParams['font.family'] = 'Noto Sans KR'\n\ndf = pd.read_csv('_data/air.csv')\n```\n:::\n\n\n::: {#7284ce41 .cell execution_count=2}\n``` {.python .cell-code}\nfrom statsmodels.tsa.seasonal import STL\n\ndecomposition = STL(df['Passengers'], period=12).fit()\n```\n:::\n\n\n::: {#a83f52df .cell execution_count=3}\n``` {.python .cell-code}\nfrom statsmodels.tsa.stattools import adfuller\n\ndf_diff = np.diff(df['Passengers'], n=1)\n\nADF_result = adfuller(df_diff)\nADF_result[0], ADF_result[1]\n```\n\n::: {.cell-output .cell-output-display execution_count=37}\n```\n(-2.8292668241700025, 0.05421329028382508)\n```\n:::\n:::\n\n\n::: {#ee167ae9 .cell execution_count=4}\n``` {.python .cell-code}\ndf_diff = np.diff(df_diff, n=12)\n\nADF_result = adfuller(df_diff)\nADF_result[0], ADF_result[1]\n```\n\n::: {.cell-output .cell-output-display execution_count=38}\n```\n(-17.624862360208343, 3.823046855816035e-30)\n```\n:::\n:::\n\n\n::: {#cfb7c33f .cell execution_count=5}\n``` {.python .cell-code}\nfrom typing import Union\nfrom statsmodels.tsa.statespace.sarimax import SARIMAX\n\ndef optimize_SARIMA(endog: Union[pd.Series, list], order_list: list, d: int, D: int, s: int) -> pd.DataFrame:\n    results = []\n    for order in order_list:\n        try:\n            model = SARIMAX(endog, \n                            order=(order[0], d, order[1]), \n                            seasonal_order=(order[2], D, order[3], s),\n                            simple_differencing=False).fit(disp=False)\n        except:\n            continue\n        aic = model.aic\n        results.append([order, aic])\n    result_df = pd.DataFrame(results)\n    result_df.columns = ['(p, q, P, Q)', 'AIC']\n    result_df = result_df.sort_values(by=\"AIC\").reset_index(drop=True)\n\n    return result_df\n```\n:::\n\n\n::: {#ec034d5c .cell execution_count=6}\n``` {.python .cell-code}\nfrom itertools import product\n\ntrain = df.iloc[:-12]['Passengers']\ntest = df.iloc[-12:]\n#  ps = range(0, 4, 1)\n#  qs = range(0, 4, 1)\n#  Ps = range(0, 4, 1)\n#  Qs = range(0, 4, 1)\n# \n#  SARIMA_order_list = list(product(ps, qs, Ps, Qs))\n# \n# \n#  d = 1\n#  D = 1\n#  s = 12\n#  SARIMA_result_df = optimize_SARIMA(train, SARIMA_order_list, d, D, s)\n#  SARIMA_result_df\n```\n:::\n\n\n::: {#825f1f34 .cell execution_count=7}\n``` {.python .cell-code}\nSARIMA_model = SARIMAX(train, order=(2, 1, 1), seasonal_order=(1, 1, 2, 12), simple_differencing=False)\nSARIMA_model_fit = SARIMA_model.fit(disp=False)\n\nSARIMA_model_fit.plot_diagnostics(figsize=(10, 8))\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](06_files/figure-html/cell-8-output-1.png){width=806 height=673}\n:::\n:::\n\n\n::: {#e758f944 .cell execution_count=8}\n``` {.python .cell-code}\nfrom statsmodels.stats.diagnostic import acorr_ljungbox\n\ntr = acorr_ljungbox(SARIMA_model_fit.resid, np.arange(1, 11))\ntr\n```\n\n::: {.cell-output .cell-output-display execution_count=42}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>lb_stat</th>\n      <th>lb_pvalue</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1</th>\n      <td>0.004785</td>\n      <td>0.944850</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>0.745422</td>\n      <td>0.688864</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1.021040</td>\n      <td>0.796161</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>1.226086</td>\n      <td>0.873785</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>1.436408</td>\n      <td>0.920290</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>1.711782</td>\n      <td>0.944208</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>2.307234</td>\n      <td>0.940900</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>2.717276</td>\n      <td>0.950829</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>2.733486</td>\n      <td>0.973931</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>4.969176</td>\n      <td>0.893228</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#3b74ea29 .cell execution_count=9}\n``` {.python .cell-code}\nSARIMA_pred = SARIMA_model_fit.get_prediction(132, 143).predicted_mean\n\ntest['SARIMA_pred'] = SARIMA_pred\n\nsns.lineplot(data=df, x=df.index, y='Passengers', label='실제 값')\nsns.lineplot(data=test, x=test.index, y='SARIMA_pred', label='SARIMA 예측값')\nplt.xticks(np.arange(0, 145, 12), np.arange(1949, 1962, 1))\nplt.xlim(120, 143)\n```\n\n::: {.cell-output .cell-output-display}\n![](06_files/figure-html/cell-10-output-1.png){width=590 height=430}\n:::\n:::\n\n\n",
    "supporting": [
      "06_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}