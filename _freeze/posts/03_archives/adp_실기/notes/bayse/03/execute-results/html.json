{
  "hash": "08c56d8786f22e34fe89af491cb6cbf9",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"비율 추정\"\ndate: 2025-06-19\ncategories: [\"확률 통계\"]\n---\n\n\n![](/img/stat-thumb.jpg){.post-thumbnail}\n\n::: {#5a86ca34 .cell execution_count=1}\n``` {.python .cell-code}\nfrom scipy.stats import binom\nfrom empiricaldist import Pmf\nimport numpy as np\n\ndef make_binominal(n, p):\n  ks = np.arange(n + 1)\n  ps = binom.pmf(ks, n, p)\n  return Pmf(ps, ks)\n```\n:::\n\n\n## 유로 동전 문제\n\n::: {#c436e8cd .cell execution_count=2}\n``` {.python .cell-code}\nimport matplotlib.pyplot as plt\n\nplt.rcParams['font.family'] = 'Noto Sans KR'\n\npmf_k = make_binominal(n=250, p=0.5)\npmf_k.plot(label='coin', color='C5')\nplt.title('coin toss 이항분포')\nplt.xlabel('앞면이 나온 횟수(k)')\nplt.ylabel('PMF')\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```\nText(0, 0.5, 'PMF')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](03_files/figure-html/cell-3-output-2.png){width=594 height=451}\n:::\n:::\n\n\n- 동전을 250번 던져서 앞면의 횟수가 140과 같은 극단적인 값이 나올 확률\n\n::: {#e5afbcea .cell execution_count=3}\n``` {.python .cell-code}\npmf_k.prob_ge(140) + pmf_k.prob_le(110)\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```\nnp.float64(0.06642115124004333)\n```\n:::\n:::\n\n\n## 베이지안 추정\n\n- 동전 앞면의 비율을 균등분포로 가정하고 시작\n\n::: {#79b47d60 .cell execution_count=4}\n``` {.python .cell-code}\nhypos = np.linspace(0, 1, 101)\nprior = Pmf(1, hypos)\nlikelihood_heads = hypos\nlikelihood_tails = 1 - hypos\nlikelihood = {\n  'H': likelihood_heads,\n  'T': likelihood_tails\n}\nprior\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>probs</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0.00</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>0.01</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>0.02</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>0.03</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>0.04</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>0.96</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>0.97</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>0.98</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>0.99</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>1.00</th>\n      <td>1</td>\n    </tr>\n  </tbody>\n</table>\n<p>101 rows × 1 columns</p>\n</div>\n```\n:::\n:::\n\n\n::: {#debaa4ec .cell execution_count=5}\n``` {.python .cell-code}\ndef update_euro(pmf, dataset):\n  for data in dataset:\n    pmf *= likelihood[data]\n  pmf.normalize()\n```\n:::\n\n\n::: {#89417d4e .cell execution_count=6}\n``` {.python .cell-code}\nposterior = prior.copy()\ndataset = 'H' * 140 + 'T' * 110\n\nupdate_euro(posterior, dataset)\n\nposterior.plot(label='coin', color='C5')\nplt.title('동전 앞면 비율의 사후확률 분포')\nplt.xlabel('동전 앞면의 비율')\nplt.ylabel('PMF')\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```\nText(0, 0.5, 'PMF')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](03_files/figure-html/cell-7-output-2.png){width=594 height=451}\n:::\n:::\n\n\n::: {#9c8e307d .cell execution_count=7}\n``` {.python .cell-code}\nprint(f'동전의 앞면이 250번 중 140번 등장했다면 앞면의 비율은 {posterior.max_prob()}일 확률이 가장 높다.')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n동전의 앞면이 250번 중 140번 등장했다면 앞면의 비율은 0.56일 확률이 가장 높다.\n```\n:::\n:::\n\n\n## 삼각사전분포\n\n- 사전확률을 균등분포로 설정했지만, 실제로는 정규분포에 가까울 것이다.\n- 근데 책에서는 일단 삼각분포를 사용한다.\n\n::: {#1f040c0e .cell execution_count=8}\n``` {.python .cell-code}\nramp_up = np.arange(50)\nramp_down = np.arange(50, -1, -1)\na = np.append(ramp_up, ramp_down)\ntriangle = Pmf(a, hypos, name='triangle')\ntriangle.normalize()\n\nuniform = Pmf(1, hypos, name='uniform')\nuniform.normalize()\n\nuniform.plot(label='균등사전', color='C4')\ntriangle.plot(label='삼각사전', color='C5')\nplt.legend()\nplt.title('삼각사전분포 및 균등사전분포')\nplt.xlabel('동전 앞면의 비율')\nplt.ylabel('PMF')\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```\nText(0, 0.5, 'PMF')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](03_files/figure-html/cell-9-output-2.png){width=609 height=451}\n:::\n:::\n\n\n::: {#b64ecfdf .cell execution_count=9}\n``` {.python .cell-code}\nupdate_euro(uniform, dataset)\nupdate_euro(triangle, dataset)\n\nuniform.plot(label='균등사전', color='C4')\ntriangle.plot(label='삼각사전', color='C5')\nplt.legend()\nplt.title('삼각 및 균등 사후분포')\nplt.xlabel('동전 앞면의 비율')\nplt.ylabel('PMF')\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```\nText(0, 0.5, 'PMF')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](03_files/figure-html/cell-10-output-2.png){width=594 height=451}\n:::\n:::\n\n\n- 두 확률분포의 사후 분포간 차이는 미미함.\n- 데이터가 충분하다면 서로 다른 사전확률로 시작한다고 해도 동일한 사후확률로 수렴하는 경향이 있다.\n\n## 이항가능도함수\n\n- 갱신을 굳이 250번 하지 않아도, 이항분포를 통해 가능도를 한번에 계산할 수 있다.\n\n::: {#3a202189 .cell execution_count=10}\n``` {.python .cell-code}\ndef update_binomial(pmf, data):\n  k, n = data\n  xs = pmf.qs\n  likelihood = binom.pmf(k, n, xs)\n  pmf *= likelihood\n  pmf.normalize()\n```\n:::\n\n\n::: {#fc77bdcb .cell execution_count=11}\n``` {.python .cell-code}\nuniform2 = Pmf(1, hypos, name='uniform2')\ndata = 140, 250\nupdate_binomial(uniform2, data)\nnp.allclose(uniform, uniform2)\n```\n\n::: {.cell-output .cell-output-display execution_count=11}\n```\nTrue\n```\n:::\n:::\n\n\n## 연습문제\n\n### 4-1\n\n::: {#10d0aa86 .cell execution_count=12}\n``` {.python .cell-code}\nhypos = np.linspace(0.2, 0.33, 101)\nuniform = Pmf(1, hypos)\nprior = uniform.copy()\nprior.normalize()\n\ndata = 3, 3\nupdate_binomial(uniform, data)\nprior.plot(label='사전', color='C4')\nuniform.plot(label='사후', color='C5')\nplt.legend()\nplt.title('사전 vs 사후 분포')\nplt.xlabel('안타 비율')\nplt.ylabel('PMF')\n```\n\n::: {.cell-output .cell-output-display execution_count=12}\n```\nText(0, 0.5, 'PMF')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](03_files/figure-html/cell-13-output-2.png){width=602 height=451}\n:::\n:::\n\n\n### 4-2\n\n::: {#7e1abbbf .cell execution_count=13}\n``` {.python .cell-code}\ndef update_randomized_response(pmf, data):\n    yes_count, total = data\n    ps = pmf.qs\n    prob_yes = 0.5 + 0.5 * ps\n    likelihood = binom.pmf(yes_count, total, prob_yes)\n    pmf *= likelihood\n    pmf.normalize()\n\nhypos = np.linspace(0, 1, 101)\nuniform = Pmf(1, hypos)\nprior = uniform.copy()\nprior.normalize()\n\ndata = 80, 100\nupdate_randomized_response(uniform, data)\n\nprior.plot(label='사전', color='C4')\nuniform.plot(label='사후', color='C5')\nplt.legend()\nplt.title('Randomized Response - 사전 vs 사후 분포')\nplt.xlabel('탈세자 비율 (p)')\nplt.ylabel('PMF')\nplt.grid(True, alpha=0.3)\n```\n\n::: {.cell-output .cell-output-display}\n![](03_files/figure-html/cell-14-output-1.png){width=594 height=452}\n:::\n:::\n\n\n::: {#f571cbce .cell execution_count=14}\n``` {.python .cell-code}\nmost_likely_rate = uniform.max_prob()\nprint(f'가장 가능성이 높은 탈세자 비율: {most_likely_rate:.3f}')\n\ncredible_interval = uniform.credible_interval(0.95)\nprint(f'95% 신뢰구간: [{credible_interval[0]:.3f}, {credible_interval[1]:.3f}]')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n가장 가능성이 높은 탈세자 비율: 0.600\n95% 신뢰구간: [0.420, 0.730]\n```\n:::\n:::\n\n\n### 4-3\n\n::: {#5b9eda8f .cell execution_count=15}\n``` {.python .cell-code}\ndef update_machine_response(pmf, data, y):\n    k, n = data\n    xs = pmf.qs * (1 - y) + (1 - pmf.qs) * y\n    likelihood = binom.pmf(k, n, xs)\n    pmf *= likelihood\n    pmf.normalize()\n\nhypos = np.linspace(0, 1, 101)\nuniform = Pmf(1, hypos)\n\ndata = 140, 250\nfor y in np.linspace(0, 0.5, 6):\n    dist = uniform.copy()\n    update_machine_response(dist, data, y)\n    dist.plot(label=f'y={y:.1f}')\nplt.legend()\nplt.title('y에 따른 앞면의 비율')\nplt.xlabel('동전 앞면의 비율')\nplt.ylabel('PMF')\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```\nText(0, 0.5, 'PMF')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](03_files/figure-html/cell-16-output-2.png){width=594 height=452}\n:::\n:::\n\n\n### 4-4\n\n::: {#c2fef7c0 .cell execution_count=16}\n``` {.python .cell-code}\nhypos = np.linspace(0.1, 0.4, 101)\nuniform = Pmf(1, hypos)\nprior = Pmf(1, hypos)\nprior.normalize()\n\nprob_both_0 = (1 - hypos) ** 4\nprob_both_1 = (2 * hypos * (1 - hypos)) ** 2\nprob_both_2 = hypos ** 4\n\nlikelihood = prob_both_0 + prob_both_1 + prob_both_2\nposterior = uniform * likelihood\nposterior.normalize()\n\nprior.plot(label='사전분포', color='C1')\nposterior.plot(label='사후분포', color='C2')\nplt.legend()\nplt.title('사전 분포와 사후분포')\nplt.xlabel('우주선을 맞출 확률 (x)')\nplt.ylabel('PMF')\n\nprior_mean = prior.mean()\nposterior_mean = posterior.mean()\n\nprint(\"\\n=== 연습문제 4-4 답변 ===\")\nif posterior_mean > prior_mean:\n    print(\"✅ 데이터는 좋은 소식입니다 (GOOD)\")\n    print(f\"✅ x의 추정값이 {prior_mean:.3f}에서 {posterior_mean:.3f}로 증가했습니다 (INCREASE)\")\nelse:\n    print(\"❌ 데이터는 나쁜 소식입니다 (BAD)\")\n    print(f\"❌ x의 추정값이 {prior_mean:.3f}에서 {posterior_mean:.3f}로 감소했습니다 (DECREASE)\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n=== 연습문제 4-4 답변 ===\n❌ 데이터는 나쁜 소식입니다 (BAD)\n❌ x의 추정값이 0.250에서 0.235로 감소했습니다 (DECREASE)\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](03_files/figure-html/cell-17-output-2.png){width=602 height=451}\n:::\n:::\n\n\n",
    "supporting": [
      "03_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}